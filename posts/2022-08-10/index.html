<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css" integrity="sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs" crossorigin="anonymous">

    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js" integrity="sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4" crossorigin="anonymous"></script>

    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
        onload="go(document.body);"></script>

    <style>
.display {
  border: 1px solid #bbc;
  padding: 1em;
  background-color: #f7f7ff;
}
.example-table {
  border-collapse: collapse;
}

.example-table td {
  border: 1px solid #bbc;
  padding: 1em;
  text-align: center;
}

.example-table tr:first-child td {
  background-color: #f7f7ff;
}
      .ib { display: inline-block; }
      center { vertical-align: middle; }
      .code { white-space: pre; display: block; }
      .tables { display: flex; align-items: center; }
      .rotate180  {
        transform: rotate(180deg) translate(0px, 3px);
        display: inline-block;
      }

		/* li.cdots makes a cdots */
		li.cdots {  list-style-type: none; }
		li.cdots:before {  content: 'â‹¯'; }
		li.np1 {  list-style-type: none; }
		li.np1:before {  content: 'n+1.'; margin-left: -35px; margin-right: 5px; }

		pre.indent {
		  background-color: #eee;
		  padding: 2em;
		  margin: 1em;
		}
		pre.nobg {
		  background-color: inherit;
        padding: 0em 2em;
		}
      body {
        width: 40em;
        margin-left: 10em;
      }
    </style>
    <title>The Functional Programmer's -1/12 (2)</title>
  </head>
  <body>
    <h1>The Functional Programmer's -1/12 (2)</h1>

    I notice there's a family of different derivations you can go through to still obtain
    \[1+2+3+\cdots = -1/12\]
    Instead of computing $\alpha(q) + \alpha(-q)$, we can compute
    \[\sum_{i=0}^{n-1} \alpha(\zeta^i q)\]
    for $\zeta$ an $n^{th}$ root of unity. First let's just do the $n=3$ case as a warm-up:
    <p/>
    <h3>Multiples of 3</h3>
    Recall we start with
    \[\alpha(q) = {q\over (1-q)^2} = q + 2q^2 + 3q^3 + 4q^4 + \cdots\]
    Instead of computing $\alpha(q) + \alpha(-q)$, let's pick a cube root of unity, $\omega = e^{2\pi i/3}$,
    and compute (using the facts that $\omega^3 = 1$ and $1 + \omega + \omega^2 = 0$)
    \[\alpha(q) + \alpha(\omega q) + \alpha(\omega^2 q) = {}\]
    \[ (q + 2q^2 + 3q^3 + 4q^4 + \cdots) + {}\]
\[ (\omega q + 2\omega^2q^2 + 3q^3 + 4\omega q^4 + \cdots) + {}\]
\[ (\omega^2 q + 2\omega q^2 + 3q^3 + 4\omega^2 q^4 + \cdots)\]
    \[ = (1 + \omega + \omega^2)q + (1+\omega^2+\omega)2q^2 + (1+1+1)3q^3 +  \cdots\]
    \[ = 9q^3 + 18q^6 + 27q^9 + \cdots\]
    \[ = 9\alpha(q^3) \]
    But now let's expand out $\alpha(\omega q)$ and $\alpha(\omega^w q)$ according to their definition:
    \[\alpha(q) + {\omega q \over (1-\omega q)^2} + {\omega^2 q \over (1-\omega^2 q)^2} = 9\alpha(q^3) \tag{*}\]
    Now observe that $(q-1)(q-\omega)(q-\omega^2) = q^3 - 1$ means
    \[(1-q)(1-\omega q)(1-\omega^2 q) = 1 - q^3\]
 and dividing both sides by $(1-q)$ we get
    \[(1-\omega q)(1-\omega^2 q) = 1 + q + q^2\]
    So now let's multiply both sides of $(*)$ by $(1-\omega q)^2(1-\omega^2 q)^2 = (1 + q + q^2)^2$ to clear denominators.
     \[\alpha(q)(1+q+q^2)^2 + \omega q (1 - \omega^2 q)^2 +  \omega^2 q (1 - \omega q)^2  = 9\alpha(q^3)(1+q+q^2)^2\]
    We have to do a little more reasoning about $\omega$: observe that
    \[\omega q (1 - \omega^2 q)^2 +  \omega^2 q (1 - \omega q)^2
 =\omega q (1 - 2\omega^2 q + \omega q^2) +  \omega^2 q (1 - 2\omega q + \omega^2 q^2)\]
\[ = (\omega q - 2 q^2 + \omega^2 q^3) +   (\omega^2 q - 2 q^2 + \omega q^3)\]
\[ = (\omega+\omega^2) q - 4 q^2 + (\omega +\omega^2) q^3\]
\[ = -(q + 4q^2 + q^3)\]
Somewhat surprisingly, all appearances of $\omega$ can be eliminated. So now we know
     \[\alpha(q)(1+q+q^2)^2 - (q + 4q^2 + q^3) = 9\alpha(q^3)(1+q+q^2)^2\]
Moving the negative polynomial in $q$ to the right, we get
     \[\alpha(q)(1+q+q^2)^2  = (q + 4q^2 + q^3) + 9\alpha(q^3)(1+q+q^2)^2\]
    And so we guess that there is a simple functional program realizing this isomorphism.
    <p/>
    Already we can see that if we substitute $q=1$, we obtain
     \[9\alpha(1)  = 6 + 81\alpha(1)\]
    which also tells us that $\alpha(1) = 6/(9-81) = -1/12$.

<h3>Multiples of $n$</h3>
To get the general case, we're going to engage in some generating-function shenanigans.

Notice that we can define (and I'm silently omitting a lot of details of how I arrived at these
particular rational functions!)
\[\begin{align*}
\beta(z, q) &= {z (1+zq)\over (1-zq)(1-zq^2)(1-z)}\\
\mu(z, q) &= {z^2 (1+zq)\over (1-zq)^3(1-zq^2)(1-z)}\\
\rho(z, q) &= {z(1+zq)\over (1-zq)^3}
\end{align*} \]
And expand $\mu, \beta, \rho$ as power series in $z$, yielding a sequence of finite polynomials in $q$:
<center><table class="example-table">
<tr><td>\(\mu = \)</td><td>\(\beta =\)</td><td>\(\rho =\)</td></tr>
<tr><td></td><td>$z+{}$</td><td>$z+{}$</td></tr>
<tr><td>$z^2 +{}$</td><td>$z^2(1 + q)^2+{}$</td><td>$4z^2q+{}$</td></tr>
<tr><td>$z^3(1 + 4q + q^2)+{}$</td><td>$z^3(1 + q + q^2)^2+{}$</td><td>$9z^3q^2+{}$</td></tr>
<tr><td>$z^4(1 + 4q + 10q^2 + 4q^3 + q^4)+{}$</td><td>$z^4(1 + q + q^2 + q^3 )^2+{}$</td><td>$16z^4q^3+{}$</td></tr>
<tr><td>$\cdots$</td><td>$\cdots$</td><td>$\cdots$</td></tr>
</table></center>
<p/>Notice that
<ul>
<li>The $z^n$ term of $\mu$ is a polynomial in $q$ that has rising then falling coefficients,
all of the form ${k+3 \choose k}$. Let's call this polynomial $M_n$.
 Notice we recover the $1 + 4q + q^2$ polynomial that appeared in the $n=3$ case.
<li>The $z^n$ term of $\beta$ is the square of the $q$-integer $[n]_q = 1 + q + \cdots q^{n-1}$.
<li>The $z^n$ term of $\rho$ is $n^2 q^{n-1}$.
</ul>

Now we'll prove an easy identity that holds between these functions.
<p/><b>Lemma</b> \[ \beta = (1-q)^2\mu + \rho\]
<p/><b>Proof</b>:
\[ \beta - (1-q)^2\mu = {z (1+zq)\over (1-zq)(1-zq^2)(1-z)} - {z^2 (1+zq)(1-q)^2 \over (1-zq)^3(1-zq^2)(1-z)}\]
\[= {z (1+zq)(1-zq)^2 - z^2 (1+zq)(1-q)^2 \over (1-zq)^3(1-zq^2)(1-z)}\]
\[= {z(1+zq)(  (1-zq)^2 - z (1-q)^2) \over (1-zq)^3(1-zq^2)(1-z)}\]
\[= {z(1+zq)(1-zq^2)(1-z) \over (1-zq)^3(1-zq^2)(1-z)}\]
\[= {z(1+zq) \over (1-zq)^3}\]
&#x220e;
<p/>
Now let's see what this equation tells us at the $z^n$ coefficient in particular. We have
\[ [n]_q^2 = (1-q)^2M_n + n^2 q^{n-1}\]
Multiply both sides by  $q/(1-q)^2$:
\[{q\over (1-q)^2} [n]_q^2 = qM_n + n^2 {q^{n}\over (1-q)^2}\]
but $[n]_q = (1-q^n)/(1-q)$ so
\[{1\over (1-q)^2} = {[n]_q^2\over (1-q^n)^2}\]
which means
\[{q\over (1-q)^2} [n]_q^2 = qM_n + n^2 {q^{n} [n]_q^2 \over (1-q^n)^2}\]
that is,
<div class="display">
\[\alpha(q)  [n]_q^2 = qM_n + n^2 \alpha(q^n) [n]_q^2 \]
</div>
<!-- <p/> <a id="mark" style="color: red;">DEBUG</a> -->

<p/><b>Conjecture</b>: For all $n$, there is a functional program that
realizes this equality as an isomorphism of types.

<h3>Getting -1/12 Again</h3>
We now want to set $q=1$. The $q$-deformed integer $[n]_q^2$ just becomes the regular integer
$n^2$, but we need to evaluate $M_n$ at $q=1$.
We look to its generating function, and find that we get $\mu(z,1) = z^2(1+z)/(1-z)^5$.
This produces the sequence
\[z^2 + 6z^3 + 20z^4 + 50z^5 + 105z^6 + 196z^7 + 336z^8 +\cdots\]
which is <a href="https://oeis.org/A002415">A002415</a>, the 4-d square pyramidal numbers,
which are given by $n^2(n^2-1)/12$. So we find
\[\alpha(1) n^2    = n^2(n^2-1)/12 + n^4 \alpha(1) \]
\[\alpha(1) (n^2-n^4)    = n^2(n^2-1)/12 \]
\[\alpha(1) n^2(1-n^2)    = n^2(n^2-1)/12 \]
\[\alpha(1)     = -1/12 \]


</body>
  <script>
	 function go(body) {
    renderMathInElement( body, { strict: false, trust: true,
      delimiters: [ {left: "$$", right: "$$", display: true}, {left:
      "\\[", right: "\\]", display: true}, {left: "$", right: "$",
      display: false}, {left: "\\(", right: "\\)", display: false} ],
      macros: {
		  "\\cc": "\\mathop{::}",
		  "\\ms": "\\mathsf",
		  "\\iso": "\\mathsf{iso}",
		  "\\bnone": "\\mathsf{None}",
		  "\\bjust": "\\mathsf{Just}\\,",
		  "\\binl": "\\mathbf{inl}\\,",
		  "\\binr": "\\mathbf{inr}\\,",
		  "\\x": "\\times",
		  "\\celse": "\\mathrel{|}",
		  "\\st": "\\mathrel{|}",
		  "\\rid": "\\mathrm{id}",
		  "\\ll": "\\langle",
		  "\\rr": "\\rangle",
 } } );
//      setTimeout(() => jump('mark'), 400);
	 }

function jump(h){
    var url = location.href;
    location.href = "#"+h;
    history.replaceState(null,null,url);
}

  </script>

</html>
